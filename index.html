<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video to ASCII Art Converter</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 1280px;
      width: 100%;
      backdrop-filter: blur(10px);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5em;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .upload-section {
      margin-bottom: 30px;
      text-align: center;
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-input-label {
      display: inline-block;
      padding: 12px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 30px;
      font-size: 16px;
      font-weight: bold;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .file-input-label:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    .controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    label {
      font-size: 12px;
      color: #666;
      font-weight: bold;
      text-transform: uppercase;
    }

    input[type="range"] {
      width: 120px;
      height: 6px;
      background: #ddd;
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      cursor: pointer;
      border-radius: 50%;
      transition: transform 0.2s;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    select {
      padding: 8px 15px;
      border: 2px solid #ddd;
      border-radius: 20px;
      background: white;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      transition: border-color 0.3s;
    }

    select:hover {
      border-color: #667eea;
    }

    .output-section {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-direction: column;
    }

    .video-container,
    .ascii-container {
      flex: 1;
      background: #000;
      border-radius: 10px;
      padding: 10px;
      min-height: 600px;

      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .ascii-container pre {
      margin: 0;
      padding: 0;
      display: block;
      width: 100%;
      height: 100%;
      overflow: hidden;
      text-align: center;
    }

    .video-container h3,
    .ascii-container h3 {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.8;
      z-index: 10;
    }

    video {
      max-width: 100%;
      border-radius: 5px;
    }

    #asciiOutput {
      color: #0f0;
      font-size: 4px;
      line-height: 4px;
      font-family: 'Courier New', monospace;
      white-space: pre;
      text-align: center;
      margin: 0;
      padding: 0;
      letter-spacing: 0.5px;
    }

    .hidden {
      display: none;
    }

    .stats {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 15px;
      font-size: 12px;
      color: #666;
    }

    .stat {
      padding: 5px 10px;
      background: #f0f0f0;
      border-radius: 15px;
    }

    button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #recordBtn {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }

    #stopRecordBtn {
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
    }

    #fullscreenBtn {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    }

    .ascii-container.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      border-radius: 0;
      max-height: none;
      padding: 20px;
    }

    .ascii-container.fullscreen h3 {
      display: none;
    }

    .ascii-container.fullscreen pre {
      width: 100% !important;
      height: 100% !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .fullscreen-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.9);
      z-index: 9998;
      display: none;
    }

    .fullscreen-overlay.active {
      display: block;
    }

    @media (max-width: 768px) {
      .output-section {
        flex-direction: column;
      }

      h1 {
        font-size: 1.8em;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ðŸŽ¬ Video to ASCII Art Converter</h1>

    <div class="upload-section">
      <div class="file-input-wrapper">
        <input type="file" id="videoInput" accept="video/*">
        <label for="videoInput" class="file-input-label">Choose Video File</label>
      </div>
    </div>

    <div class="controls">
      <div class="control-group">
        <label for="resolution">Resolution</label>
        <input type="range" id="resolution" min="50" max="800" value="100">
        <span id="resolutionValue">100</span>
      </div>

      <div class="control-group">
        <label for="contrast">Contrast</label>
        <input type="range" id="contrast" min="0.5" max="2" step="0.1" value="1">
        <span id="contrastValue">1.0</span>
      </div>

      <div class="control-group">
        <label for="brightness">Brightness</label>
        <input type="range" id="brightness" min="-50" max="50" value="0">
        <span id="brightnessValue">0</span>
      </div>

      <div class="control-group">
        <label for="charset">Character Set</label>
        <select id="charset">
          <option value="standard">Standard</option>
          <option value="detailed">Detailed</option>
          <option value="blocks">Blocks</option>
          <option value="simple">Simple</option>
        </select>
      </div>

      <div class="control-group">
        <label for="colorMode">Color Mode</label>
        <select id="colorMode">
          <option value="green">Matrix Green</option>
          <option value="white">White</option>
          <option value="color">Full Color</option>
        </select>
      </div>

      <button id="playPauseBtn" class="hidden">Play/Pause</button>
      <button id="recordBtn" class="hidden">Start Recording</button>
      <button id="stopRecordBtn" class="hidden">Stop Recording</button>
      <button id="fullscreenBtn" class="hidden">Fullscreen ASCII</button>
    </div>

    <div class="output-section">
      <div class="video-container">
        <h3>Original Video</h3>
        <video id="videoPlayer" controls class="hidden"></video>
      </div>

      <div class="ascii-container">
        <h3>ASCII Output</h3>
        <pre id="asciiOutput"></pre>
      </div>
    </div>

    <div class="stats">
      <div class="stat">FPS: <span id="fps">0</span></div>
      <div class="stat">Frame: <span id="frameCount">0</span></div>
      <div class="stat">Size: <span id="dimensions">0x0</span></div>
    </div>
  </div>

  <canvas id="canvas" style="display: none;"></canvas>
  <canvas id="recordCanvas" style="display: none;"></canvas>
  <div class="fullscreen-overlay" id="fullscreenOverlay"></div>

  <script>
    const charSets = {
      standard: ' .:-=+*#%@',
      detailed: ' .\'`^",:;Il!i><~+_-?][}{1)(|/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$',
      blocks: ' â–‘â–’â–“â–ˆ',
      simple: ' .oO@'
    };

    let video, canvas, ctx, asciiOutput;
    let recordCanvas, recordCtx;
    let isProcessing = false;
    let isRecording = false;
    let frameCount = 0;
    let lastFrameTime = Date.now();
    let currentFPS = 0;
    let mediaRecorder;
    let recordedChunks = [];

    document.addEventListener('DOMContentLoaded', () => {
      video = document.getElementById('videoPlayer');
      canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');
      recordCanvas = document.getElementById('recordCanvas');
      recordCtx = recordCanvas.getContext('2d');
      asciiOutput = document.getElementById('asciiOutput');

      // File input handler
      document.getElementById('videoInput').addEventListener('change', handleFileSelect);

      // Control listeners
      document.getElementById('resolution').addEventListener('input', (e) => {
        document.getElementById('resolutionValue').textContent = e.target.value;
      });

      document.getElementById('contrast').addEventListener('input', (e) => {
        document.getElementById('contrastValue').textContent = e.target.value;
      });

      document.getElementById('brightness').addEventListener('input', (e) => {
        document.getElementById('brightnessValue').textContent = e.target.value;
      });

      document.getElementById('playPauseBtn').addEventListener('click', () => {
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
      });

      document.getElementById('recordBtn').addEventListener('click', startRecording);
      document.getElementById('stopRecordBtn').addEventListener('click', stopRecording);
      document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);

      video.addEventListener('play', () => {
        isProcessing = true;
        processFrame();
      });

      video.addEventListener('pause', () => {
        isProcessing = false;
      });

      video.addEventListener('ended', () => {
        isProcessing = false;
      });


    });

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;

      const url = URL.createObjectURL(file);
      video.src = url;
      video.classList.remove('hidden');
      document.getElementById('playPauseBtn').classList.remove('hidden');
      document.getElementById('recordBtn').classList.remove('hidden');
      document.getElementById('fullscreenBtn').classList.remove('hidden');

      video.addEventListener('loadedmetadata', () => {
        document.getElementById('dimensions').textContent = `${video.videoWidth}x${video.videoHeight}`;
      });
    }

    function processFrame() {
      if (!isProcessing || video.paused || video.ended) return;

      const resolution = parseInt(document.getElementById('resolution').value);
      const contrast = parseFloat(document.getElementById('contrast').value);
      const brightness = parseInt(document.getElementById('brightness').value);
      const charset = charSets[document.getElementById('charset').value];
      const colorMode = document.getElementById('colorMode').value;

      // Set canvas size based on resolution with performance optimization
      const width = Math.min(resolution, 800); // Cap width for performance
      const height = Math.floor((video.videoHeight / video.videoWidth) * width * 0.8);

      canvas.width = width;
      canvas.height = height;

      // Calculate font size to fit the ASCII art in the container
      const container = asciiOutput.parentElement;
      const containerWidth = container.clientWidth - 20; // Account for padding
      const containerHeight = container.clientHeight - 20;
      
      // Calculate font size based on available space and ASCII dimensions
      const fontWidth = containerWidth / width;
      const fontHeight = containerHeight / height;
      const fontSize = Math.max(2, Math.min(fontWidth, fontHeight));
      
      asciiOutput.style.fontSize = fontSize + 'px';
      asciiOutput.style.lineHeight = fontSize + 'px';

      // Draw video frame to canvas
      ctx.filter = `contrast(${contrast}) brightness(${100 + brightness}%)`;
      ctx.drawImage(video, 0, 0, width, height);

      // Get image data
      const imageData = ctx.getImageData(0, 0, width, height);
      const pixels = imageData.data;

      let ascii = '';

      if (colorMode === 'color') {
        ascii = '<div style="font-family: monospace; line-height: 0.8em; letter-spacing: 0.3em;">';
        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            const i = (y * width + x) * 4;
            const r = pixels[i];
            const g = pixels[i + 1];
            const b = pixels[i + 2];
            const brightness = (r + g + b) / 3;

            const charIndex = Math.floor((brightness / 255) * (charset.length - 1));
            const char = charset[charIndex];

            ascii += `<span style="color: rgb(${r},${g},${b})">${char}</span>`;
          }
          ascii += '<br>';
        }
        ascii += '</div>';
        asciiOutput.innerHTML = ascii;
      } else {
        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            const i = (y * width + x) * 4;
            const brightness = (pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3;

            const charIndex = Math.floor((brightness / 255) * (charset.length - 1));
            ascii += charset[charIndex];
          }
          ascii += '\n';
        }
        asciiOutput.textContent = ascii;
        asciiOutput.style.color = colorMode === 'green' ? '#0f0' : '#fff';
      }

      // Capture frame for recording if active
      if (isRecording) {
        captureAsciiFrame();
      }

      // Update stats
      frameCount++;
      const now = Date.now();
      if (now - lastFrameTime >= 1000) {
        currentFPS = Math.round(frameCount / ((now - lastFrameTime) / 1000));
        frameCount = 0;
        lastFrameTime = now;
        document.getElementById('fps').textContent = currentFPS;
      }
      document.getElementById('frameCount').textContent = Math.floor(video.currentTime * 30);

      // Process next frame with throttling for better performance
      setTimeout(() => {
        if (isProcessing) {
          requestAnimationFrame(processFrame);
        }
      }, 1000 / 30); // Limit to ~30 FPS
    }

    function startRecording() {
      if (isRecording) return;
      
      isRecording = true;
      recordedChunks = [];
      
      // Set up recording canvas
      const container = asciiOutput.parentElement;
      recordCanvas.width = container.clientWidth;
      recordCanvas.height = container.clientHeight;
      
      // Set up MediaRecorder
      const stream = recordCanvas.captureStream(30); // 30 FPS
      mediaRecorder = new MediaRecorder(stream, {
        mimeType: 'video/webm;codecs=vp9'
      });
      
      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          recordedChunks.push(event.data);
        }
      };
      
      mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ascii-art-video.webm';
        a.click();
        URL.revokeObjectURL(url);
      };
      
      mediaRecorder.start();
      
      // Update UI
      document.getElementById('recordBtn').classList.add('hidden');
      document.getElementById('stopRecordBtn').classList.remove('hidden');
      document.getElementById('recordBtn').textContent = 'Recording...';
    }

    function stopRecording() {
      if (!isRecording) return;
      
      isRecording = false;
      mediaRecorder.stop();
      
      // Update UI
      document.getElementById('stopRecordBtn').classList.add('hidden');
      document.getElementById('recordBtn').classList.remove('hidden');
      document.getElementById('recordBtn').textContent = 'Start Recording';
    }

    function captureAsciiFrame() {
      if (!isRecording) return;
      
      // Draw the ASCII container background
      recordCtx.fillStyle = '#000';
      recordCtx.fillRect(0, 0, recordCanvas.width, recordCanvas.height);
      
      // Create a temporary div to render the ASCII art
      const tempDiv = document.createElement('div');
      tempDiv.style.position = 'absolute';
      tempDiv.style.left = '-9999px';
      tempDiv.style.top = '-9999px';
      tempDiv.style.fontFamily = 'Courier New, monospace';
      tempDiv.style.fontSize = asciiOutput.style.fontSize;
      tempDiv.style.lineHeight = asciiOutput.style.lineHeight;
      tempDiv.style.color = asciiOutput.style.color;
      tempDiv.style.whiteSpace = 'pre';
      tempDiv.style.textAlign = 'center';
      tempDiv.style.letterSpacing = '0.5px';
      tempDiv.textContent = asciiOutput.textContent;
      
      document.body.appendChild(tempDiv);
      
      // Convert text to canvas
      const textCanvas = document.createElement('canvas');
      const textCtx = textCanvas.getContext('2d');
      
      // Measure text dimensions
      textCtx.font = `${asciiOutput.style.fontSize} Courier New`;
      const lines = asciiOutput.textContent.split('\n');
      const lineHeight = parseInt(asciiOutput.style.lineHeight);
      const maxWidth = Math.max(...lines.map(line => textCtx.measureText(line).width));
      const totalHeight = lines.length * lineHeight;
      
      textCanvas.width = maxWidth;
      textCanvas.height = totalHeight;
      
      // Draw text
      textCtx.fillStyle = '#000';
      textCtx.fillRect(0, 0, textCanvas.width, textCanvas.height);
      textCtx.font = `${asciiOutput.style.fontSize} Courier New`;
      textCtx.fillStyle = asciiOutput.style.color;
      textCtx.textAlign = 'center';
      
      lines.forEach((line, index) => {
        textCtx.fillText(line, textCanvas.width / 2, (index + 1) * lineHeight);
      });
      
      // Draw to recording canvas
      const x = (recordCanvas.width - textCanvas.width) / 2;
      const y = (recordCanvas.height - textCanvas.height) / 2;
      recordCtx.drawImage(textCanvas, x, y);
      
      // Clean up
      document.body.removeChild(tempDiv);
    }

    function toggleFullscreen() {
      const asciiContainer = document.querySelector('.ascii-container');
      const overlay = document.getElementById('fullscreenOverlay');
      const fullscreenBtn = document.getElementById('fullscreenBtn');
      
      if (asciiContainer.classList.contains('fullscreen')) {
        // Exit fullscreen
        asciiContainer.classList.remove('fullscreen');
        overlay.classList.remove('active');
        fullscreenBtn.textContent = 'Fullscreen ASCII';
        document.body.style.overflow = '';
        
        // Reset font size to normal
        setTimeout(() => {
          if (isProcessing) {
            const container = asciiOutput.parentElement;
            const containerWidth = container.clientWidth - 20;
            const containerHeight = container.clientHeight - 20;
            
            const resolution = parseInt(document.getElementById('resolution').value);
            const width = Math.min(resolution, 800);
            const height = Math.floor((video.videoHeight / video.videoWidth) * width * 0.8);
            
            const fontWidth = containerWidth / width;
            const fontHeight = containerHeight / height;
            const fontSize = Math.max(2, Math.min(fontWidth, fontHeight));
            
            asciiOutput.style.fontSize = fontSize + 'px';
            asciiOutput.style.lineHeight = fontSize + 'px';
          }
        }, 100);
      } else {
        // Enter fullscreen
        asciiContainer.classList.add('fullscreen');
        overlay.classList.add('active');
        fullscreenBtn.textContent = 'Exit Fullscreen';
        document.body.style.overflow = 'hidden';
        
         // Recalculate font size for fullscreen
         setTimeout(() => {
           const container = asciiOutput.parentElement;
           const containerWidth = container.clientWidth - 40; // Account for padding
           const containerHeight = container.clientHeight - 40;
           
           const resolution = parseInt(document.getElementById('resolution').value);
           const width = Math.min(resolution, 800);
           const height = Math.floor((video.videoHeight / video.videoWidth) * width * 0.8);
           
           const fontWidth = containerWidth / width;
           const fontHeight = containerHeight / height;
           const fontSize = Math.max(2, Math.min(fontWidth, fontHeight));
           
           asciiOutput.style.fontSize = fontSize + 'px';
           asciiOutput.style.lineHeight = fontSize + 'px';
           
           // Ensure ASCII content is visible
           if (asciiOutput.textContent.trim() === '') {
             asciiOutput.textContent = 'ASCII Art will appear here when video is playing...';
           }
         }, 100);
      }
    }

    // Handle escape key to exit fullscreen
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const asciiContainer = document.querySelector('.ascii-container');
        if (asciiContainer.classList.contains('fullscreen')) {
          toggleFullscreen();
        }
      }
    });
  </script>
</body>

</html>
